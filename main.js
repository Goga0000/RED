//чекбоксы и ратио
document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelectorAll(".w-radio-input, .w-checkbox-input");e.forEach(e=>{let t=e.closest("label");if(t){if(t.classList.contains("select-ratio-item")){let s=()=>{e.classList.contains("w--redirected-checked")?t.classList.add("w--redirected-checked"):t.classList.remove("w--redirected-checked")},c=new MutationObserver(s);c.observe(e,{attributes:!0,attributeFilter:["class"]}),s()}else{let r=t.querySelector(".label-radio, .w-form-label, span"),i=()=>{e.classList.contains("w--redirected-checked")?r&&r.classList.add("w--redirected-checked"):r&&r.classList.remove("w--redirected-checked")},a=new MutationObserver(i);a.observe(e,{attributes:!0,attributeFilter:["class"]}),i()}}})});
// валидация квиза
document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelector("#modal-quiz-static"),t=e.querySelector("#form-button-quiz"),r=e.querySelector("#Name-quiz"),o=e.querySelector("#Phone-quiz"),l=e.querySelectorAll('input[type="radio"][name="social"]'),s=e.querySelector("#error-name-quiz"),i=e.querySelector("#error-phone-quiz"),a="null",n=!1,c=!1,d=!1,u=null,y=window.intlTelInput(o,{initialCountry:"auto",geoIpLookup(e){fetch("https://ipinfo.io/json",{cache:"reload"}).then(e=>{if(!e.ok)throw Error("Ошибка загрузки geoIP");return e.json()}).then(t=>{a=t.country?t.country.toLowerCase():null,console.log("Определена страна по IP в geoIpLookup:",a),e(a)}).catch(()=>e(a))},utilsScript:"https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.19/build/js/utils.js",autoPlaceholder:"polite",separateDialCode:!1,nationalMode:!1});function v(e){e.style.display="block",e.style.opacity="1",e.style.pointerEvents="auto"}function p(e){e.style.opacity="0",e.style.pointerEvents="none",setTimeout(()=>e.style.display="none",200)}function $(){if(!n)return p(s),r.style.borderColor="",r.style.color="#010104",r.classList.remove("active"),!1;let e=r.value.trim().length>0;return e?(r.classList.add("active"),p(s),r.style.borderColor="",r.style.color="#010104"):(v(s),r.style.borderColor="#DB1A2A",r.style.color="#010104"),e}function m(){if(!c){p(i),o.style.borderColor="";let e=o.closest(".iti"),t=e?e.querySelector(".iti__flag-container"):null;return e&&e.style.removeProperty("border-color"),t&&t.style.removeProperty("border-color"),o.style.color="#010104",!1}let r=o.value.trim(),l=r.replace(/\D/g,""),s=/^[+\d\s\-\(\)]+$/.test(r),a=y.isValidNumber(),n=l.length>=6,d=o.closest(".iti"),u=d?d.querySelector(".iti__flag-container"):null,$=s&&a&&n;return $?(o.classList.add("active"),p(i),o.style.borderColor="",d&&(d.style.setProperty("border-color","#20B20F","important"),d.classList.add("active")),u&&(u.style.setProperty("border-color","#20B20F","important"),u.classList.add("active")),o.style.color="#010104"):(o.classList.remove("active"),v(i),o.style.setProperty("border-color","#DB1A2A","important"),d&&(d.style.setProperty("border-color","#DB1A2A","important"),d.classList.remove("active")),u&&(u.style.setProperty("border-color","#DB1A2A","important"),u.classList.remove("active")),o.style.color="#010104"),$}function _(){return Array.from(l).some(e=>e.checked)}function L(){$()&&m()&&_()?(t.disabled=!1,t.classList.add("active"),t.classList.remove("passive")):(t.disabled=!0,t.classList.remove("active"),t.classList.add("passive"))}setTimeout(()=>{try{let e=y.getSelectedCountryData();e&&e.dialCode&&(u=e.dialCode,(""===o.value.trim()||"+"===o.value.trim())&&(o.value=`+${u}`,c=!1,m(),L()))}catch(t){console.error("Ошибка при определении кода страны:",t),u=null}},300),o.addEventListener("input",()=>{c=!0;let e=o.value.trim().match(/^\+(\d{1,4})/);e&&(u=e[1]),m(),L()}),o.addEventListener("blur",()=>{let e=o.value.trim();(""===e||"+"===e)&&u?o.value=`+${u}`:/^\+\d{1,4}$/.test(e)&&!u&&(o.value="")}),r.addEventListener("input",()=>{n=!0,$(),L()}),l.forEach(e=>e.addEventListener("change",()=>{d=!0,L()})),e.addEventListener("submit",e=>{n=!0,c=!0,d=!0,$()&&m()&&_()||(e.preventDefault(),L())}),t.disabled=!0,t.classList.add("passive"),t.classList.remove("active"),document.addEventListener("click",e=>{if(!e.target.closest("#Phone-quiz"))try{let t=o.value.trim(),r=y.getSelectedCountryData();if(r&&r.dialCode){let l=`+${r.dialCode}`,s=""===t||"+"===t||t===l||t.startsWith(l)&&t.replace(/\D/g,"").length<=l.replace(/\D/g,"").length;s&&(o.value=l,u=r.dialCode,c=!1,m(),L())}}catch(i){console.error("Ошибка при восстановлении кода страны:",i)}})});
// range slider
document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelector(".modal-quiz.modal");if(!e)return;let t=e.querySelector('[range-slider="track"]'),n=e.querySelector('[range-slider="fill"]'),a=e.querySelector('[range-back="fill"]'),i=e.querySelectorAll('[range-slider="handle"]');if(i.length<2){console.error("Минимум 2 ручки слайдера");return}let r=i[0],l=i[1],s=r.querySelector('[data-number="min"]'),c=l.querySelector('[data-number="max"]'),u=e.querySelector('input[data="inputMin"]'),d=e.querySelector('input[data="inputMax"]'),o=parseInt(u.value.replace(/\s/g,""))||5e4,v=parseInt(d.value.replace(/\s/g,""))||5e5;function m(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}function _(e,t,n){return Math.min(Math.max(e,t),n)}function L(e){let n=t.getBoundingClientRect(),a=(e-n.left)/n.width;return Math.round(5e4+45e4*(a=_(a,0,1)))}function f(){o=_(o,5e4,5e5),v=_(v,5e4,5e5),o>v-1&&(o=v-1),v<o+1&&(v=o+1)}function g(e,t,n,a){e.style.transition=a?t+" 0.4s ease":"none",e.style[t]=n}function p(e,t,n,a){e&&(e.style.transition=a?"left 0.4s ease, width 0.4s ease":"none",e.style.left=`${t}%`,e.style.width=`${n}%`)}function y(e=!1){let t=(o-5e4)/45e4*100,i=(5e5-v)/45e4*100;g(r,"left",`calc(${t}%)`,e),g(r,"right","auto",e),g(l,"right",`calc(${i}%)`,e),g(l,"left","auto",e);let u=100-i;p(n,t,u-t,!1),p(a,t,u-t,!1),s.textContent=m(o),c.textContent=m(v)}function $(e,t){e.value="min"===t?m(o):m(v)}function E(e,t){if(!/^\d+(\s\d+)*$/.test(e.value.trim()))return $(e,t),e.classList.remove("active"),!1;let n=Number(e.value.replace(/\s/g,""));return"min"===t?(n<5e4&&(n=5e4),n>v-1&&(n=v-1),o=n):(n>5e5&&(n=5e5),n<o+1&&(n=o+1),v=n),f(),y(!0),$(e,t),n>=5e4&&n<=5e5?e.classList.add("active"):e.classList.remove("active"),!0}function h(e,t){let n="min"===t?"timerMin":"timerMax";window[n]&&clearTimeout(window[n]),window[n]=setTimeout(()=>{E(e,t),window[n]=null},1e4)}function q(e,t){let n=e.target;n.value=n.value.replace(/[^\d\s]/g,"");let a=Number(n.value.replace(/\s/g,""));a>=5e4&&a<=5e5?n.classList.add("active"):n.classList.remove("active"),h(n,t)}function x(e,t){let n=!1,a;function i(e){e.preventDefault(),n=!0,a=t?o:v,y(!1)}function r(){n&&(n=!1,(t?o<5e4||o>v-1:v>5e5||v<o+1)&&(t?o=a:v=a),f(),y(!0),u.value=m(o),d.value=m(v),o>=5e4&&o<=5e5?u.classList.add("active"):u.classList.remove("active"),v>=5e4&&v<=5e5?d.classList.add("active"):d.classList.remove("active"))}function l(e){if(!n)return;let a,i=L(a=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX);t?o=i:v=i,f(),y(!1)}e.addEventListener("mousedown",i),document.addEventListener("mouseup",r),document.addEventListener("mouseleave",r),document.addEventListener("mousemove",l),e.addEventListener("touchstart",i,{passive:!1}),document.addEventListener("touchend",r),document.addEventListener("touchcancel",r),document.addEventListener("touchmove",l,{passive:!1})}u.addEventListener("input",e=>q(e,"min")),d.addEventListener("input",e=>q(e,"max")),u.addEventListener("keydown",()=>{window.timerMin&&clearTimeout(window.timerMin)}),d.addEventListener("keydown",()=>{window.timerMax&&clearTimeout(window.timerMax)}),u.addEventListener("blur",()=>E(u,"min")),d.addEventListener("blur",()=>E(d,"max")),t.addEventListener("click",e=>{let t=L(e.clientX);if(Math.abs(t-o)<Math.abs(t-v)){let n=o;((o=t)<5e4||o>v-1)&&(o=n)}else{let a=v;((v=t)>5e5||v<o+1)&&(v=a)}f(),y(!1),u.value=m(o),d.value=m(v),o>=5e4&&o<=5e5?u.classList.add("active"):u.classList.remove("active"),v>=5e4&&v<=5e5?d.classList.add("active"):d.classList.remove("active")}),x(r,!0),x(l,!1),f(),y(!1)});
//логика и переключение основного квиза
document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelectorAll("[quiz-step]"),t=document.querySelectorAll("[quiz-step-indicator]"),r=1;function i(e,t=250){return new Promise(r=>{e.style.transition=`opacity ${t}ms ease`,e.style.opacity="0",setTimeout(()=>{e.style.display="none",r()},t)})}function l(e,t=250){return new Promise(r=>{e.style.display="flex",e.style.transition=`opacity ${t}ms ease`,requestAnimationFrame(()=>{e.style.opacity="1"}),setTimeout(()=>{r()},t)})}async function a(r){for(let a of e){let n=Number(a.getAttribute("quiz-step"));n!==r&&"none"!==getComputedStyle(a).display&&await i(a)}let s=Array.from(e).find(e=>Number(e.getAttribute("quiz-step"))===r);s&&(await l(s),t.forEach(e=>{let t=Number(e.getAttribute("quiz-step-indicator"));t===r?e.classList.add("active-step"):e.classList.remove("active-step")}),o(s))}function n(){let e=document.querySelector('[quiz-step="1"]'),t=e.querySelectorAll('[country="radio"] input[type="checkbox"]');return Array.from(t).some(e=>e.checked)}function s(){let e=document.querySelector('[quiz-step="2"]'),t=e.querySelectorAll("input");return!(t.length<2)&&Array.from(t).every(e=>e.classList.contains("active"))}function c(){let e=document.querySelector('[quiz-step="3"]');return Array.from(e.querySelectorAll('input[type="checkbox"][data-name]')).some(e=>e.checked)}function u(){let e=document.querySelector('[quiz-step="4"]'),t=e.querySelectorAll("input[required]");for(let r of t)if(!r.value.trim()||!r.classList.contains("active"))return!1;let i=e.querySelector('input[type="radio"][data-name][name="social"]:checked');return!!i}function o(e){let t=Number(e.getAttribute("quiz-step")),r=e.querySelector('[data-bttn="next"], [data-bttn-result], input[data-bttn="result"]');if(!r)return;let i=!1;1===t?i=n():2===t?i=s():3===t?i=c():4===t&&(i=u()),i?(r.disabled=!1,r.classList.add("active"),r.classList.remove("passive")):(r.disabled=!0,r.classList.remove("active"),r.classList.add("passive"))}e.forEach(t=>{let i=Number(t.getAttribute("quiz-step"));if(2!==i&&(t.addEventListener("input",()=>o(t)),t.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(e=>{e.addEventListener("change",()=>o(t))})),2===i){let l=t.querySelectorAll("input");l.forEach(e=>{let r=new MutationObserver(()=>o(t));r.observe(e,{attributes:!0,attributeFilter:["class"]})})}let n=t.querySelector('[data-bttn="next"], [data-bttn-result], input[data-bttn="result"]');n&&n.addEventListener("click",t=>{t.preventDefault(),n.disabled||(i===e.length?console.log("Отправка формы или показ результата"):a(++r))});let s=t.querySelector('[data-bttn="prev"]');s&&s.addEventListener("click",e=>{e.preventDefault(),a(r=Math.max(1,r-1))})}),a(r)});
//валидация основной формы
document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelector("#modal-form-static"),t=e.querySelector("#form-button"),r=e.querySelector("#Name"),l=document.querySelector("#Phone"),o=document.querySelectorAll('input[type="radio"][name="Social"]'),s=e.querySelector("#error-name"),i=e.querySelector("#error-phone"),a="null",n=!1,c=!1,d=!1,u=null,y=window.intlTelInput(l,{initialCountry:"auto",geoIpLookup(e){fetch("https://ipinfo.io/json").then(e=>e.json()).then(t=>e(a=t.country?t.country.toLowerCase():null)).catch(()=>e(a))},utilsScript:"https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.19/build/js/utils.js",autoPlaceholder:"polite",separateDialCode:!1,nationalMode:!1});function v(e){e.style.display="block",e.style.opacity="1",e.style.pointerEvents="auto"}function p(e){e.style.opacity="0",e.style.pointerEvents="none",setTimeout(()=>e.style.display="none",200)}function $(){if(!n)return p(s),r.style.borderColor="",r.style.color="#010104",r.classList.remove("active"),!1;let e=r.value.trim().length>0;return e?(r.classList.add("active"),p(s),r.style.borderColor="",r.style.color="#010104"):(v(s),r.style.borderColor="#DB1A2A",r.style.color="#010104"),e}function _(){if(!c)return p(i),l.style.borderColor="",l.closest(".iti")&&l.closest(".iti").style.removeProperty("border-color"),l.style.color="#010104",!1;let e=l.value.trim(),t=e.replace(/\D/g,""),r=/^[+\d\s\-\(\)]+$/.test(e),o=y.isValidNumber(),s=t.length>=6,a=l.closest(".iti"),n=a?a.querySelector(".iti__flag-container"):null,d=r&&o&&s;return d?(l.classList.add("active"),p(i),l.style.borderColor="",a&&(a.style.setProperty("border-color","#20B20F","important"),a.classList.add("active")),n&&(n.style.setProperty("border-color","#20B20F","important"),n.classList.add("active")),l.style.color="#010104"):(l.classList.remove("active"),v(i),l.style.setProperty("border-color","#DB1A2A","important"),a&&(a.style.setProperty("border-color","#DB1A2A","important"),a.classList.remove("active")),n&&(n.style.setProperty("border-color","#DB1A2A","important"),n.classList.remove("active")),l.style.color="#010104"),d}function m(){return Array.from(o).some(e=>e.checked)}function L(){$()&&_()&&m()?(t.disabled=!1,t.classList.add("active"),t.classList.remove("passive")):(t.disabled=!0,t.classList.remove("active"),t.classList.add("passive"))}setTimeout(()=>{try{let e=y.getSelectedCountryData();e&&e.dialCode&&(u=e.dialCode,(""===l.value.trim()||"+"===l.value.trim())&&(l.value=`+${u}`,c=!1,_(),L()))}catch(t){console.error("Ошибка при определении кода страны:",t),u=null}},300),l.addEventListener("blur",()=>{let e=l.value.trim();if(""===e||"+"===e)u=null;else if(/^\+\d{1,4}$/.test(e)){let t=e.match(/^\+(\d{1,4})$/);t&&(u=t[1])}}),l.addEventListener("input",()=>{c=!0;let e=l.value.trim().match(/^\+(\d{1,4})/);e&&(u=e[1]),_(),L()}),r.addEventListener("input",()=>{n=!0,$(),L()}),o.forEach(e=>e.addEventListener("change",()=>{d=!0,L()})),e.addEventListener("submit",e=>{n=!0,c=!0,d=!0,$()&&_()&&m()||(e.preventDefault(),L())}),t.disabled=!0,t.classList.add("passive"),t.classList.remove("active"),document.addEventListener("click",e=>{if(!e.target.closest("#Phone"))try{let t=l.value.trim(),r=y.getSelectedCountryData();if(r&&r.dialCode){let o=`+${r.dialCode}`,s=""===t||"+"===t||t===o||t.startsWith(o)&&t.replace(/\D/g,"").length<=o.replace(/\D/g,"").length;s&&(l.value=o,u=r.dialCode,c=!1,_(),L())}}catch(i){console.error("Ошибка при восстановлении кода страны:",i)}})});
// код для формы
document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("page-url-form"),t=document.getElementById("page-url-quiz"),n=window.location.href;e&&(e.value=n),t&&(t.value=n)});
// кнопка вверх
document.getElementById("upper-bttn").addEventListener("click",function(){window.scrollTo({top:0,behavior:"smooth"})}),document.getElementById("upper-bttn-2").addEventListener("click",function(){window.scrollTo({top:0,behavior:"smooth"})});
